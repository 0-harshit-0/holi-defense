(()=>{"use strict";var t={dropletStore:[],splashStore:[]},e=["./assets/splash1.svg","./assets/splash2.svg","./assets/splash3.svg"],r=["./assets/ballon1.svg","./assets/ballon2.svg","./assets/ballon3.svg","./assets/ballon4.svg"],i=document.querySelector("#canvas"),o=i.getContext("2d");i.width=innerWidth,i.height=innerHeight;var s={xp:void 0,yp:void 0},a=new VecShapes(o);function n(){this.pos=new Vector2D(i.width/2,i.height),this.radius=3;var t=void 0!==s.xp?s.xp-i.width/2:0,e=void 0!==s.yp?s.yp-i.height:-10,r=new Vector2D(t,e),o=Vector2D.magnitude(r),n=Math.min(o/50,14),h=Vector2D.setMag(n,r),l=new Vector2D(2*(Math.random()-.5),2*(Math.random()-.5)),d=Vector2D.add(h,l);this.vel=Vector2D.limit(14,d),this.fallStartTime=null,this.draw=function(){a.circle(this.pos,this.radius),a.fill("lightblue"),this.pos=Vector2D.add(this.pos,this.vel),this.vel.y>=0&&null===this.fallStartTime&&(this.fallStartTime=Date.now()),this.pos.y<i.height&&(this.vel.y+=.1)}}function h(t,r){this.pos=new Vector2D(t,r),this.width=30+20*Math.random(),this.height=.75*this.width,this.alpha=1,this.sprite=new Image,this.sprite.src=e[Math.floor(Math.random()*e.length)]}addEventListener("resize",(function(){i.width=innerWidth,i.height=innerHeight})),addEventListener("mousemove",(function(t){s.xp=t.x,s.yp=t.y})),h.prototype.draw=function(){this.sprite.complete&&(o.save(),o.globalAlpha=this.alpha,o.drawImage(this.sprite,this.pos.x-this.width/2,this.pos.y-this.height/2,this.width,this.height),o.restore()),this.alpha-=.02};var l=0;addEventListener("keypress",(function(e){if("a"===e.key){var r=Date.now();r-l>=300&&(t.dropletStore.push(new n),l=r)}})),function e(){requestAnimationFrame(e),o.fillStyle="rgba(0, 0, 0, 0.1)",o.fillRect(0,0,i.width,i.height);for(var r=0;r<t.dropletStore.length;r++){t.dropletStore[r].draw();var s=Date.now();null!==t.dropletStore[r].fallStartTime&&s-t.dropletStore[r].fallStartTime>=1e3?(t.splashStore.push(new h(t.dropletStore[r].pos.x,t.dropletStore[r].pos.y)),t.dropletStore.splice(r,1),r--):t.dropletStore[r]&&t.dropletStore[r].pos.y>=i.height&&null===t.dropletStore[r].fallStartTime&&(t.dropletStore[r].fallStartTime=Date.now())}for(var a=0;a<t.splashStore.length;a++)t.splashStore[a].draw(),t.splashStore[a].alpha<=0&&(t.splashStore.splice(a,1),a--)}();var d=parseInt(localStorage.getItem("holydefense_ind_score_"))||0,c="https://0harshit0.pythonanywhere.com",p="holydefense_ind_user",u=JSON.parse(localStorage.getItem(p));if(!u){var f=Date.now(),g=Math.random().toString(36).substring(2,8),m="".concat(f,"_").concat(g),v="Player_".concat(g);u={id:m,name:v},localStorage.setItem(p,JSON.stringify(u))}function S(t){t.innerText="".concat(u.name," | Score: ").concat(d)}function w(t){fetch(c+"/leaderboard").then((function(t){if(!t.ok)throw new Error("Failed to fetch leaderboard");return t.json()})).catch((function(t){return[]})).then((function(e){var r="Leaderboard:\n",i=1,o=0;e.forEach((function(t){r+=i+". "+t.name+" - "+t.score+"\n",t.id===u.id&&(o=i),i++})),r+="\nYour Rank: "+o,t.innerText=r}))}function y(t){fetch(c+"/submit_score",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:u.id,name:u.name,score:t})}).then((function(t){if(!t.ok)throw new Error("Failed to submit score");return t.json()})).then((function(t){})).catch((function(t){}))}var b=document.querySelector("#balloon-canvas"),D=b.getContext("2d");b.width=innerWidth,b.height=innerHeight;var x=document.getElementById("scoreboard"),I=document.getElementById("leaderboard");S(x);var M=[],V=!1,T=0;function _(){this.radius=15,this.pos=new Vector2D(Math.random()*b.width,-this.radius),this.vel=new Vector2D(0,0),this.acc=b.height/16200,this.sprite=new Image,this.sprite.src=r[Math.floor(Math.random()*r.length)]}function E(t,e){var r=t.pos.x-e.pos.x,i=t.pos.y-e.pos.y;return Math.sqrt(r*r+i*i)<t.radius+e.radius}_.prototype.update=function(){this.vel.y+=this.acc,this.pos=Vector2D.add(this.pos,this.vel)},_.prototype.draw=function(){this.sprite.complete?D.drawImage(this.sprite,this.pos.x-this.radius,this.pos.y-this.radius,2*this.radius,2*this.radius):(D.beginPath(),D.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),D.fillStyle="red",D.fill(),D.closePath())},setInterval((function(){V||M.push(new _)}),2e3),function e(){if(!V){requestAnimationFrame(e),D.clearRect(0,0,b.width,b.height);for(var r=0;r<M.length;r++){var i=M[r];if(i.update(),i.draw(),i.pos.y-i.radius>=b.height&&(T++,M.splice(r,1),r--,T>=9))return V=!0,y(d),w(I),void alert("Game Over! Your score: "+d)}for(var o=t.dropletStore.length-1;o>=0;o--)for(var s=M.length-1;s>=0;s--)if(E(t.dropletStore[o],M[s])){t.dropletStore.splice(o,1),M.splice(s,1),d=d+1,localStorage.setItem("holydefense_ind_score_",d),S(x);break}}}()})();